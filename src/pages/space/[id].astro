---
const { id } = Astro.params;

// Validación: Si no hay ID, mandamos al home o 404
if (!id) {
    return Astro.redirect('/porfolio');
}

// Fetch del lanzamiento específico usando el ID
const response = await fetch(`https://api.spacexdata.com/v5/launches/${id}`);

// Si la API devuelve error (ej. 404 Not Found), redirigimos
if (!response.ok) {
    return Astro.redirect('/porfolio/404'); // Asegúrate de tener una página 404 o redirige a /porfolio
}

const launch = await response.json();
---

<main class="detail">
    <header class="detail__bar">
        <a href={`/porfolio/space`} class="detail__back">← Volver al listado</a>
        <span class={`detail__status ${launch.success ? 'detail__status--ok' : 'detail__status--ko'}`}>{launch.success ? 'Misión Exitosa' : 'Misión Fallida'}</span>
    </header>

    <section class="detail__content">
        <figure class="detail__figure">
            <img src={launch.links.patch.large || launch.links.patch.small} alt={launch.name} />
        </figure>

        <div class="detail__info">
            <h1 class="detail__title">{launch.name}</h1>
            <p class="detail__meta">Vuelo #{launch.flight_number} • {new Date(launch.date_utc).toLocaleString()}</p>

            <div class="detail__card">
                <h3 class="detail__cardTitle">Detalles de la misión</h3>
                <p>{launch.details || "No hay descripción técnica disponible para este lanzamiento."}</p>
            </div>

            {launch.links.webcast && (
                <a href={launch.links.webcast} target="_blank" rel="noreferrer" class="detail__youtube">
                    Ver en YouTube
                </a>
            )}
        </div>
    </section>
</main>

<style>
    .detail { min-height: 100vh; background:#0f172a; color:#fff; padding:2rem; display:flex; align-items:center; }
    .detail__bar { max-width: 64rem; margin: 0 auto 1.25rem; display:flex; justify-content:space-between; align-items:center; }
    .detail__back { color:#60a5fa; text-decoration:none; font-weight:600; }
    .detail__back:hover { color:#93c5fd; }
    .detail__status { padding:.25rem .75rem; border-radius:999px; font-size:.875rem; font-weight:700; letter-spacing:.02em; }
    .detail__status--ok { background:rgba(34,197,94,.15); color:#34d399; }
    .detail__status--ko { background:rgba(239,68,68,.15); color:#f87171; }

    .detail__content { max-width:64rem; margin:0 auto; display:grid; grid-template-columns: 240px 1fr; gap:2rem; align-items:start; background:#1f2937; border:1px solid #374151; border-radius: .75rem; padding:1.5rem; box-shadow: 0 10px 20px rgba(0,0,0,.25); }
    .detail__figure { display:flex; justify-content:center; align-items:center; background: rgba(148,163,184,.15); border-radius:.5rem; padding:1rem; }
    .detail__figure img { width: 200px; height:auto; object-fit:contain; filter: drop-shadow(0 6px 12px rgba(0,0,0,.45)); }
    .detail__info { display:flex; flex-direction:column; gap: .75rem; }
    .detail__title { font-size: clamp(1.75rem, 3vw, 2.5rem); font-weight:800; margin:0; }
    .detail__meta { color:#94a3b8; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .detail__card { background:#111827; border:1px solid #374151; border-radius:.5rem; padding:1rem; }
    .detail__cardTitle { color:#60a5fa; font-size:1rem; margin:0 0 .5rem; }
    .detail__youtube { display:inline-block; margin-top:.5rem; background:#dc2626; color:#fff; text-decoration:none; padding:.65rem 1rem; border-radius:.5rem; font-weight:700; }
    .detail__youtube:hover { background:#b91c1c; }

    @media (max-width: 768px) {
        .detail__content { grid-template-columns: 1fr; }
        .detail { padding:1rem; }
    }
</style>