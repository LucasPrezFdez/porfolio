---
import MiLayout from "../layouts/MiLayout.astro";

/*
    esta web nos da el tiempo en una ciudad determinada wttr.in/vigo?format=j1
    muestra el tiempo actual
    el usuario podra escribir en una caja de texto la ciudad que quiere consultar
*/
---



<MiLayout>
    <form id="form">
        <label>Ciudad</label>
        <input id="city" name="city" placeholder="Introduce la ciudad">
        <button>Obtener tiempo</button>
        <div id="info">
            ...
        </div>
    </form>
</MiLayout>

<script>
    const $form = document.getElementById('form')
    $form?.addEventListener('submit',async (e:SubmitEvent) => {
        e.preventDefault()
        // const city = document.getElementById('city')?.value
        const target = e.target as HTMLFormElement
        const city = target.city.value
        const response = await fetch(`https://wttr.in/${city}?format=j1`)
        const data = await response.json()

        document.getElementById('info') &&
        (document.getElementById('info')!.innerHTML  =`
            <div>${data?.current_condition?.[0].temp_C ?? 'N/A'}</div>
            <div>${data?.current_condition?.[0].lang_es[0].value ?? 'Sin descripcion'}</div>
        `)

        
    })
</script>